<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AnyXlaunch ‚Äî Launch on any meme platform</title>
  <meta name="description" content="Attach image. Add ticker. Auto fair launch to Bags, Pumpfun, Moonit, or LetsBonk." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="icon" href="asset/logo.png" />
  <link rel="icon" href="assets/logo.png" />
  <style>
    :root { --bg:#000; --fg:#fff; --muted:#bfbfbf; --line:#1a1a1a; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg); font:16px/1.5 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:flex; flex-direction:column;
    }
    header, main, footer{width:100%; max-width:980px; margin:0 auto; padding:24px}
    header{display:flex; align-items:center; gap:16px; border-bottom:1px solid var(--line)}
    .logo{display:flex; align-items:center; gap:14px; text-decoration:none; color:var(--fg)}
    .logo img{width:44px; height:44px; display:block}
    .brand{font-weight:600; letter-spacing:.2px}
    .tag{@supports (font-variant-caps: all-small-caps){font-variant-caps:all-small-caps}}
    .hero{padding:72px 24px 48px; text-align:center}
    .hero h1{margin:0 0 12px; font-size:40px; letter-spacing:.2px}
    .hero p{margin:0 auto 28px; max-width:640px; color:var(--muted)}
    .steps{display:flex; gap:16px; justify-content:center; flex-wrap:wrap; margin:0 0 40px}
    .chip{
      border:1px solid var(--line); padding:10px 14px; border-radius:999px; color:var(--muted);
      font-size:14px; letter-spacing:.2px
    }
    .card{
      border:1px solid var(--line); border-radius:12px; padding:20px; max-width:720px; margin:0 auto; background:rgba(255,255,255,.01)
    }
    label{display:block; font-size:13px; color:var(--muted); margin:14px 0 6px}
    input[type="text"], select, .file{
      width:100%; padding:12px 14px; border-radius:10px; border:1px solid var(--line); background:#0a0a0a; color:var(--fg);
      appearance:none; outline:none
    }
    .row{display:grid; grid-template-columns:1fr 180px; gap:14px}
    .actions{display:flex; gap:12px; margin-top:18px; flex-wrap:wrap; justify-content:center}
    button{
      padding:12px 16px; border-radius:10px; background:#fff; color:#000; border:0; cursor:pointer; font-weight:600
    }
    button.ghost{background:transparent; color:var(--fg); border:1px solid var(--line)}
    button[disabled]{opacity:.5; cursor:not-allowed}
    .preview{
      margin-top:16px; display:none; border-top:1px solid var(--line); padding-top:16px; color:var(--muted); font-size:14px
    }
    .preview img{width:64px; height:64px; object-fit:cover; border-radius:8px; border:1px solid var(--line); background:#0a0a0a}
    footer{margin-top:auto; border-top:1px solid var(--line); color:var(--muted); font-size:13px; display:flex; justify-content:space-between; flex-wrap:wrap}
    .handle{opacity:.9}
    .platforms{opacity:.9}
    @media (max-width:720px){ .hero h1{font-size:32px} .row{grid-template-columns:1fr} }
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .wallet-info{margin-left:auto; font-size:13px; color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <a class="logo" href="#" aria-label="AnyXlaunch home">
      <img id="siteLogo" src="asset/anyxlaunchlogo.png" alt="AnyXlaunch logo" />
      <div>
        <div class="brand">AnyXlaunch</div>
        <div class="tag" aria-label="tagline">Attach. Name. Launch.</div>
      </div>
    </a>
    <div class="wallet-info" id="walletInfo">Not connected</div>
  </header>

  <main>
    <section class="hero" aria-labelledby="headline">
      <h1 id="headline">Launch on any meme platform. Automatically.</h1>
      <p>Two ways to launch: <strong>Tweet <a href="https://x.com/AnyXlaunch" target="_blank" style="color:var(--fg);text-decoration:underline">@AnyXlaunch</a> @bags @pumpfun @moonit @letsbonk</strong> with name, ticker & logo for instant deployment, or use this website form below.</p>
      <div class="steps" aria-label="launch methods">
        <span class="chip">üê¶ Tweet @ platform</span>
        <span class="chip">or</span>
        <span class="chip">üåê Use this website</span>
      </div>

      <div class="card" role="form" aria-label="launch form">
        <label for="img">Project image</label>
        <input id="img" class="file" type="file" accept="image/*" />

        <label for="name">Token Name</label>
        <input id="name" type="text" maxlength="32" placeholder="e.g. Flube Token" />

        <div class="row">
          <div>
            <label for="ticker">Ticker</label>
            <input id="ticker" type="text" maxlength="12" placeholder="e.g. FLUBE" />
          </div>
          <div>
            <label for="platform">Platform</label>
            <select id="platform" aria-label="Select launch platform">
              <option value="bags">Bags</option>
              <option value="pumpfun">Pumpfun</option>
              <option value="moonit">Moonit</option>
              <option value="letsbonk">LetsBonk</option>
            </select>
          </div>
        </div>

        <label for="description">Description (Optional)</label>
        <input id="description" type="text" maxlength="200" placeholder="Describe your token..." />

        <div class="actions">
          <button id="connect" type="button">Connect Phantom</button>
          <button id="previewBtn" class="ghost" type="button">Preview</button>
          <button id="submit" type="button" disabled>Prepare Fair Launch</button>
        </div>

        <div id="preview" class="preview" aria-live="polite">
          <div style="display:flex; align-items:center; gap:12px; margin-bottom:10px">
            <img id="previewImg" alt="preview" />
            <div>
              <div><strong id="previewTicker">‚Äî</strong> on <span id="previewPlatform">‚Äî</span></div>
              <div>Handle: <span class="handle">@AnyXlaunch</span></div>
            </div>
          </div>
          <div class="platforms">Launch on launchpad on X mention whatever launchpad @ on X add in name ticker and logo and it will be deployed automatically</div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <span>¬© <span id="year"></span> AnyXlaunch</span>
    <span>Powered by Solana</span>
  </footer>

  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/bs58@5.0.0/index.js"></script>
  <script>
    const $ = (s)=>document.querySelector(s);
    const img = $('#img'), name = $('#name'), ticker = $('#ticker'), description = $('#description'), platform = $('#platform');
    const submit = $('#submit'), previewBtn = $('#previewBtn'), pv = $('#preview');
    const pvImg = $('#previewImg'), pvTicker = $('#previewTicker'), pvPlat = $('#previewPlatform');
    const year = $('#year'); year.textContent = new Date().getFullYear();
    const walletInfo = $('#walletInfo');
    const siteLogo = $('#siteLogo');
    
    // Debug mode - set to true for detailed logging
    const DEBUG_MODE = true;
    
    // CORS Proxy helper function
    async function proxyFetch(url, options = {}) {
      const proxyUrl = '/api/proxy';
      const proxyOptions = {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          url: url,
          method: options.method || 'GET',
          headers: options.headers || {},
          body: options.body
        })
      };
      
      const response = await fetch(proxyUrl, proxyOptions);
      const result = await response.json();
      
      if (!result.success) {
        throw new Error(`Proxy error: ${result.error}`);
      }
      
      return {
        ok: result.status >= 200 && result.status < 300,
        status: result.status,
        json: () => Promise.resolve(result.data),
        text: () => Promise.resolve(typeof result.data === 'string' ? result.data : JSON.stringify(result.data))
      };
    }

    // Robust logo fallback: try several common paths/names
    (function resolveLogo(){
      const candidates = [
        'asset/anyxlaunchlogo.png',
        'asset/logo.png',
        'assets/logo.png',
        'asset/logo.svg',
        'assets/logo.svg',
        'asset/anyxlaunch-logo-white.png',
        'assets/anyxlaunch-logo-white.png'
      ];
      let i = 0;
      const tryNext = () => {
        if (i >= candidates.length) {
          console.warn('No logo found, using placeholder');
          siteLogo.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDQiIGhlaWdodD0iNDQiIHZpZXdCb3g9IjAgMCA0NCA0NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ0IiBoZWlnaHQ9IjQ0IiByeD0iOCIgZmlsbD0iIzFhMWExYSIvPgo8dGV4dCB4PSIyMiIgeT0iMjgiIGZvbnQtZmFtaWx5PSJzeXN0ZW0tdWkiIGZvbnQtc2l6ZT0iMTYiIGZvbnQtd2VpZ2h0PSI2MDAiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkE8L3RleHQ+Cjwvc3ZnPg==';
          return;
        }
        const test = new Image();
        const src = candidates[i++];
        test.onload = () => { 
          console.log('‚úÖ Logo loaded:', src);
          siteLogo.src = src; 
        };
        test.onerror = () => {
          console.warn('‚ùå Logo failed:', src);
          tryNext();
        };
        test.src = src + '?v=' + Date.now();
      };
      // If initial src fails, start trying
      siteLogo.addEventListener('error', tryNext, { once: true });
      // Start immediately
      tryNext();
    })();

    // placeholder wallet connect
    const provider = window.solana;
    let connectedPubkey = null;

    async function updateBalance(pubkey) {
      try {
        // Use Helius API for reliable balance fetching
        const heliusRpc = 'https://mainnet.helius-rpc.com/?api-key=bc40e3e4-98df-4d4f-99cf-dd22cc091955';
        const connection = new solanaWeb3.Connection(heliusRpc, 'confirmed');
        
        console.log('üîÑ Fetching balance for:', pubkey);
        const balanceLamports = await connection.getBalance(new solanaWeb3.PublicKey(pubkey));
        const sol = (balanceLamports / 1_000_000_000).toFixed(4);
        
        walletInfo.textContent = pubkey.slice(0, 4) + '‚Ä¶' + pubkey.slice(-4) + ' ‚Ä¢ ' + sol + ' SOL';
        console.log('‚úÖ Balance updated:', sol, 'SOL');
        
      } catch (e) {
        console.error('‚ùå Balance fetch failed:', e);
        walletInfo.textContent = pubkey.slice(0, 4) + '‚Ä¶' + pubkey.slice(-4) + ' ‚Ä¢ balance unavailable';
      }
    }

    async function connectPhantom() {
      if (!provider || !provider.isPhantom) {
        alert('Phantom not found. Please install Phantom Wallet.');
        return;
      }
      try {
        const res = await provider.connect();
        connectedPubkey = res.publicKey.toString();
        $('#connect').textContent = 'Connected';
        await updateBalance(connectedPubkey);
      } catch (e) {
        console.warn('Phantom connect error', e);
      }
    }

    // Try eager connect if trusted
    (async () => {
      try {
        if (provider?.isPhantom) {
          const res = await provider.connect({ onlyIfTrusted: true });
          if (res?.publicKey) {
            connectedPubkey = res.publicKey.toString();
            $('#connect').textContent = 'Connected';
            await updateBalance(connectedPubkey);
          }
        }
      } catch {}
    })();

    $('#connect').addEventListener('click', connectPhantom);

    // Test API connections on page load
    (async function testAPIs() {
      if (!DEBUG_MODE) return;
      
      console.log('üß™ Testing API connections...');
      console.log('üìç Current URL:', window.location.href);
      console.log('üåê Protocol:', window.location.protocol);
      
      // Test 1: Bags API - Try multiple endpoints
      try {
        console.log('üß™ Testing Bags API endpoints...');
        
        // Test direct API call first (should work if CORS is properly configured)
        try {
          const directResponse = await fetch('https://public-api-v2.bags.fm/api/v1/endpoint', {
            method: 'GET',
            headers: {
              'x-api-key': 'bags_prod_3zpiHpFX3GsG0ZzA5XOQmJw06Go8pPVjRuqDHq0jD2Q'
            }
          });
          
          if (directResponse.ok || directResponse.status === 404) {
            console.log('‚úÖ Bags API: Direct access works! No CORS issues.');
          } else {
            console.log('‚ö†Ô∏è Bags API Direct: Status', directResponse.status);
          }
        } catch (directError) {
          console.log('‚ùå Bags API Direct failed:', directError.message);
          
          // Fallback to proxy
          try {
            console.log('üîÑ Trying Bags API via CORS proxy...');
            const proxyResponse = await proxyFetch('https://public-api-v2.bags.fm/api/v1/endpoint', {
              method: 'GET',
              headers: {
                'x-api-key': 'bags_prod_3zpiHpFX3GsG0ZzA5XOQmJw06Go8pPVjRuqDHq0jD2Q'
              }
            });
            
            if (proxyResponse.ok || proxyResponse.status === 404) {
              console.log('‚úÖ Bags API: Accessible via CORS proxy!');
            } else {
              console.warn('‚ö†Ô∏è Bags API Proxy: Status', proxyResponse.status);
            }
          } catch (proxyError) {
            console.error('‚ùå Bags API via proxy also failed:', proxyError.message);
          }
        }
        
      } catch (e) {
        console.error('‚ùå Bags API testing failed:', e.message);
      }
      
      // Test 2: PumpPortal API
      try {
        const pumpResponse = await fetch('https://pumpportal.fun/api/trade', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ test: true })
        });
        
        if (pumpResponse.status === 400 || pumpResponse.status === 422) {
          console.log('‚úÖ PumpPortal API: Accessible (got expected validation error)');
        } else {
          console.log('‚ö†Ô∏è PumpPortal API: Unexpected response -', pumpResponse.status);
        }
      } catch (e) {
        console.error('‚ùå PumpPortal API: Network error -', e.message);
      }
      
      // Test 3: Pinata IPFS
      try {
        const pinataTest = new FormData();
        pinataTest.append('file', new Blob(['test'], { type: 'text/plain' }), 'test.txt');
        
        const pinataResponse = await fetch('https://api.pinata.cloud/pinning/pinFileToIPFS', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer 72aef098005a18915fd9'
          },
          body: pinataTest
        });
        
        if (pinataResponse.ok) {
          console.log('‚úÖ Pinata IPFS: Working correctly');
        } else {
          console.warn('‚ö†Ô∏è Pinata IPFS: Error -', pinataResponse.status);
        }
      } catch (e) {
        console.error('‚ùå Pinata IPFS: Network error -', e.message);
      }
    })();

    function valid(){
      return name.value.trim().length >= 2 && ticker.value.trim().length >= 2 && platform.value && img.files.length === 1;
    }
    function updateState(){ submit.disabled = !valid(); }
    ['change','input'].forEach(evt=>{
      img.addEventListener(evt, updateState);
      name.addEventListener(evt, updateState);
      ticker.addEventListener(evt, updateState);
      description.addEventListener(evt, updateState);
      platform.addEventListener(evt, updateState);
    });

    previewBtn.addEventListener('click', ()=>{
      if (img.files[0]) {
        pvImg.src = URL.createObjectURL(img.files[0]);
      }
      pvTicker.textContent = ticker.value || '‚Äî';
      pvPlat.textContent = platform.options[platform.selectedIndex].text;
      pv.style.display = 'block';
      window.scrollTo({ top: pv.offsetTop - 24, behavior: 'smooth' });
    });

    // Real launch implementation
    submit.addEventListener('click', async ()=>{
      if (!valid()) return;
      if (!connectedPubkey) {
        alert('Please connect your wallet first');
        return;
      }
      
      submit.disabled = true;
      submit.textContent = 'Preparing Launch...';
      
      try {
        const imageFile = img.files[0];
        const tokenName = name.value.trim();
        const tokenTicker = ticker.value.trim().toUpperCase();
        const tokenDescription = description.value.trim() || `${tokenName} (${tokenTicker}) launched via AnyXlaunch`;
        const selectedPlatform = platform.value;
        
        // Upload image to IPFS first
        const imageUrl = await uploadToIPFS(imageFile);
        
        // Create token based on platform
        let transaction;
        switch(selectedPlatform) {
          case 'bags':
            transaction = await createOnBags(tokenName, tokenTicker, tokenDescription, imageUrl);
            break;
          case 'pumpfun':
            transaction = await createOnPump(tokenName, tokenTicker, tokenDescription, imageUrl);
            break;
          case 'moonit':
            transaction = await createOnMoonit(tokenName, tokenTicker, tokenDescription, imageUrl);
            break;
          case 'letsbonk':
            transaction = await createOnBonk(tokenName, tokenTicker, tokenDescription, imageUrl);
            break;
          default:
            throw new Error('Platform not supported');
        }
        
        // Sign and send transaction
        submit.textContent = 'Sign Transaction...';
        const signature = await provider.signAndSendTransaction(transaction);
        
        submit.textContent = 'Confirming...';
        // Wait for confirmation using Helius
        const connection = new solanaWeb3.Connection('https://mainnet.helius-rpc.com/?api-key=bc40e3e4-98df-4d4f-99cf-dd22cc091955', 'confirmed');
        await connection.confirmTransaction(signature, 'confirmed');
        
        alert(`üéâ Token launched successfully!\n\nTransaction: ${signature}\n\nView on Solscan: https://solscan.io/tx/${signature}`);
        
      } catch (error) {
        console.error('Launch error:', error);
        
        // Detailed error messages
        let errorMessage = 'Launch failed: ';
        if (error.message.includes('User rejected')) {
          errorMessage += 'Transaction was rejected in wallet';
        } else if (error.message.includes('insufficient funds')) {
          errorMessage += 'Insufficient SOL balance for transaction';
        } else if (error.message.includes('Bags API error')) {
          errorMessage += `Bags.fm API issue: ${error.message}`;
        } else if (error.message.includes('Pump.fun error')) {
          errorMessage += `Pump.fun API issue: ${error.message}`;
        } else {
          errorMessage += error.message;
        }
        
        alert(errorMessage);
      } finally {
        submit.disabled = false;
        submit.textContent = 'Prepare Fair Launch';
      }
    });

    // IPFS Upload using Pinata (free tier)
    async function uploadToIPFS(file) {
      const formData = new FormData();
      formData.append('file', file);
      
      const response = await fetch('https://api.pinata.cloud/pinning/pinFileToIPFS', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer 72aef098005a18915fd9'
        },
        body: formData
      });
      
      if (!response.ok) {
        // Fallback to placeholder if IPFS fails
        return 'https://via.placeholder.com/512x512/000000/FFFFFF?text=' + encodeURIComponent(ticker.value);
      }
      
      const data = await response.json();
      return `https://gateway.pinata.cloud/ipfs/${data.IpfsHash}`;
    }

    // Bags.fm Integration - Try direct API first, then proxy
    async function createOnBags(tokenName, symbol, description, imageUri) {
      const connection = new solanaWeb3.Connection('https://mainnet.helius-rpc.com/?api-key=bc40e3e4-98df-4d4f-99cf-dd22cc091955', 'confirmed');
      
      try {
        if (DEBUG_MODE) console.log('üîÑ Bags.fm integration starting...', { tokenName, symbol, description, imageUri });
        
        // Helper function to try API call (direct or via proxy)
        const tryBagsAPI = async (useDirect = true) => {
          const fetchFn = useDirect ? fetch : proxyFetch;
          const logPrefix = useDirect ? 'üåê Direct' : 'üì° Proxy';
          
          console.log(`${logPrefix}: Creating Bags token launch config...`);
          
          const configResponse = await fetchFn('https://public-api-v2.bags.fm/api/v1/token-launch/create-config', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'x-api-key': 'bags_prod_3zpiHpFX3GsG0ZzA5XOQmJw06Go8pPVjRuqDHq0jD2Q'
            },
            body: useDirect ? JSON.stringify({ launchWallet: connectedPubkey }) : { launchWallet: connectedPubkey }
          });
          
          if (!configResponse.ok) {
            throw new Error(`Config API failed: ${configResponse.status}`);
          }
          
          const configData = await configResponse.json();
          console.log(`‚úÖ ${logPrefix} Config response:`, configData);
          
          if (!configData.success) {
            throw new Error(`Config failed: ${configData.error || 'Unknown error'}`);
          }
          
          console.log(`${logPrefix}: Creating Bags launch transaction...`);
          
          const launchPayload = {
            configId: configData.response?.id || configData.id,
            metadata: {
              name: tokenName,
              symbol: symbol,
              description: description,
              image: imageUri,
              external_url: "https://anyxlaunch.vercel.app"
            },
            initialLiquiditySOL: 0.1,
            creatorWallet: connectedPubkey
          };
          
          const launchResponse = await fetchFn('https://public-api-v2.bags.fm/api/v1/token-launch/create', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'x-api-key': 'bags_prod_3zpiHpFX3GsG0ZzA5XOQmJw06Go8pPVjRuqDHq0jD2Q'
            },
            body: useDirect ? JSON.stringify(launchPayload) : launchPayload
          });
          
          if (!launchResponse.ok) {
            const errorText = await launchResponse.text();
            throw new Error(`Launch API failed: ${launchResponse.status} - ${errorText}`);
          }
          
          const launchData = await launchResponse.json();
          console.log(`‚úÖ ${logPrefix} Launch response:`, launchData);
          
          if (!launchData.success) {
            throw new Error(`Launch failed: ${launchData.error || 'Unknown error'}`);
          }
          
          // Return transaction for signing
          if (launchData.response?.transaction || launchData.transaction) {
            const txData = launchData.response?.transaction || launchData.transaction;
            const transaction = solanaWeb3.Transaction.from(Buffer.from(txData, 'base64'));
            return transaction;
          } else {
            throw new Error('No transaction returned from Bags API');
          }
        };
        
        // Try direct API call first
        try {
          return await tryBagsAPI(true);
        } catch (directError) {
          console.warn('‚ùå Direct Bags API failed:', directError.message);
          
          // Try via proxy
          try {
            console.log('üîÑ Retrying via CORS proxy...');
            return await tryBagsAPI(false);
          } catch (proxyError) {
            console.warn('‚ùå Proxy Bags API also failed:', proxyError.message);
            
            // Final fallback to manual creation
            const bagsUrl = `https://bags.fm/create?name=${encodeURIComponent(tokenName)}&symbol=${encodeURIComponent(symbol)}&description=${encodeURIComponent(description)}&image=${encodeURIComponent(imageUri)}`;
            
            const userChoice = confirm(`Bags.fm API failed:\n\nDirect: ${directError.message}\nProxy: ${proxyError.message}\n\nWould you like to:\n\n‚úÖ YES - Open Bags.fm to create manually\n‚ùå NO - Try Pump.fun instead`);
            
            if (userChoice) {
              window.open(bagsUrl, '_blank');
              throw new Error('Opening Bags.fm for manual token creation. Your data has been pre-filled.');
            } else {
              throw new Error('Bags.fm API failed. Please try Pump.fun instead.');
            }
          }
        }
        
      } catch (error) {
        console.error('Bags integration error:', error);
        throw error;
      }
    }

    // Pump.fun Integration - Alternative approach
    async function createOnPump(tokenName, symbol, description, imageUri) {
      // First, create metadata JSON
      const metadata = {
        name: tokenName,
        symbol: symbol,
        description: description,
        image: imageUri,
        showName: true,
        createdOn: "https://anyxlaunch.tech"
      };
      
      // Upload metadata to IPFS
      const metadataBlob = new Blob([JSON.stringify(metadata)], { type: 'application/json' });
      const metadataFormData = new FormData();
      metadataFormData.append('file', metadataBlob, 'metadata.json');
      
      const metadataResponse = await fetch('https://api.pinata.cloud/pinning/pinFileToIPFS', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer 72aef098005a18915fd9'
        },
        body: metadataFormData
      });
      
      let metadataUri;
      if (metadataResponse.ok) {
        const metadataData = await metadataResponse.json();
        metadataUri = `https://gateway.pinata.cloud/ipfs/${metadataData.IpfsHash}`;
      } else {
        // Fallback metadata URI
        metadataUri = `data:application/json;base64,${btoa(JSON.stringify(metadata))}`;
      }
      
      // Try multiple approaches for Pump.fun
      let response;
      let errorMessages = [];
      
      // Approach 1: PumpPortal without API key
      try {
        response = await fetch('https://pumpportal.fun/api/trade', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            publicKey: connectedPubkey,
            action: 'create',
            tokenMetadata: {
              name: tokenName,
              symbol: symbol,
              uri: metadataUri
            },
            mint: solanaWeb3.Keypair.generate().publicKey.toString(),
            denominatedInSol: "true",
            amount: 0.01,
            slippage: 10,
            priorityFee: 0.0005,
            pool: "pump"
          })
        });
        
        if (response.ok) {
          const data = await response.json();
          const transaction = solanaWeb3.Transaction.from(Buffer.from(data.transaction, 'base64'));
          return transaction;
        } else {
          const errorText = await response.text();
          errorMessages.push(`PumpPortal: ${errorText}`);
        }
      } catch (e) {
        errorMessages.push(`PumpPortal: ${e.message}`);
      }
      
      // Approach 2: Direct Pump.fun contract call (simplified)
      try {
        // This would require implementing the actual Pump.fun program instructions
        // For now, we'll create a placeholder transaction that opens Pump.fun
        const pumpUrl = `https://pump.fun/create?name=${encodeURIComponent(tokenName)}&symbol=${encodeURIComponent(symbol)}&description=${encodeURIComponent(description)}&image=${encodeURIComponent(imageUri)}`;
        
        // Open Pump.fun in new tab for manual creation
        window.open(pumpUrl, '_blank');
        
        throw new Error(`Automatic creation failed. Opening Pump.fun for manual creation. Errors: ${errorMessages.join(', ')}`);
        
      } catch (e) {
        throw new Error(`Pump.fun integration failed: ${errorMessages.join(', ')}`);
      }
    }

    // Moonit Integration (simplified)
    async function createOnMoonit(tokenName, symbol, description, imageUri) {
      // Moonit doesn't have public creation API, so this is a placeholder
      // You'd need to reverse engineer their contract calls
      throw new Error('Moonit integration coming soon - use Bags or Pump.fun for now');
    }

    // LetsBonk Integration
    async function createOnBonk(tokenName, symbol, description, imageUri) {
      // This would integrate with bonk-mcp server or their contract directly
      throw new Error('LetsBonk integration coming soon - use Bags or Pump.fun for now');
    }
  </script>
</body>
</html>


